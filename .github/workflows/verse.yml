name: Verse of the Day to Discord

on:
  schedule:
    - cron: "0 11 * * *" # Daily at 7am Eastern
  workflow_dispatch:

jobs:
  post-verse:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.x"

      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install feedparser requests

      - name: Fetch verse and post to Discord
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          python << 'EOF'
          import feedparser
          import requests
          import html

          FEED_URL = "https://www.bible.com/verse-of-the-day/rss"
          feed = feedparser.parse(FEED_URL)

          if not feed.entries:
              raise Exception("No entries found in RSS feed")

          entry = feed.entries[0]
          description = html.unescape(entry.summary)

          payload = {
              "embeds": [
                  {
                      "title": "ðŸ“– Verse of the Day",
                      "description": description,
                      "color": 7506394,
                      "image": {
                          "url": "https://source.unsplash.com/1200x675/?bible,faith,scripture"
                      },
                      "footer": {
                          "text": "YouVersion Bible App"
                      }
                  }
              ]
          }

          response = requests.post(
              DISCORD_WEBHOOK,
              json=payload,
              timeout=10
          )

          response.raise_for_status()
          EOF
